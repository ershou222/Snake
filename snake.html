<!DOCTYPE>
<html>
<head>
<meta charset="utf8"/>
<title></title>
</head>
<body>
<script>
    var map;    //map对象
    var snake;  //snake对象
    var food;   //food对象
    var timer;  //定时器
    var score = 0;  //分数


    //定义一个function Map()
    function Map()
    {
        //地图的宽度
        this.width = 800;
        //地图的高度
        this.height = 800;
        //地图的定位方式
        this.position = 'absolute';
        //地图
        this._map = null;
        //地图颜色
        this.color = 'yellow';

        //定义show的function()
        this.show= function()
        {   
            //创建一个div赋值
            this._map = document.createElement('div');
            //将样式（宽度,高度,定位方式,背景颜色）赋值
            this._map.style.width = this.width + 'px';
            this._map.style.height = this.height + 'px';
            this._map.style.position = this.position;
            this._map.style.backgroundColor = this.color;
            //追加到body中
            document.getElementsByTagName('body')[0].appendChild(this._map);
        }
    }

    //定义一个function Map()
    function Food()
    {
        //地图的宽度
        this.width = 40;
        //地图的高度
        this.height = 40;
        //地图的定位方式
        this.position = 'absolute';
        //地图
        this._food = null;
        //地图颜色
        this.color = 'green';
        //横坐标
        this.x;
        //纵坐标
        this.y;

        //定义show的function()
        this.show= function()
        {   
            if(this._food == null)
            {
                //创建一个div赋值
                this._food = document.createElement('div');
                //将样式（宽度,高度,定位方式,背景颜色）赋值
                this._food.style.width = this.width + 'px';
                this._food.style.height = this.height + 'px';
                this._food.style.position = this.position;
                this._food.style.backgroundColor = this.color;
            }
            //求0-20的随机数并向下取整
            this.x = Math.floor(Math.random()*20);
            this.y = Math.floor(Math.random()*20);
            //食物坐标
            this._food.style.left = this.x*this.width + 'px';
            this._food.style.top = this.y*this.height + 'px';
            //追加到body中
            map._map.appendChild(this._food);
        }

    }
    //定义一个function Snake()
    function Snake()
    {
        
        //蛇的宽度
        this.width = 40;
        //蛇的高度
        this.height = 40;
        //蛇的定位方式
        this.position = 'absolute';
        //蛇的方向
        this.direct = '';

        //蛇的全部信息
        //二维数组中的每个数组的第一项放置横坐标第二项纵坐标第三项颜色第四项为null（后面赋值）
        this.body = [[3,2,'red',null],[2,2,'blue',null],[1,2,'blue',null]];

        //定义show的function()
        this.show = function()
        {   
            for(var i =0;i < this.body.length;i++){
                if(this.body[i][3] == null){
                    //创建一个div赋值
                    this.body[i][3] = document.createElement('div');
                    //将样式（宽度,高度,定位方式,背景颜色）赋值
                    this.body[i][3].style.width = this.width + 'px';
                    this.body[i][3].style.height = this.height + 'px';
                    this.body[i][3].style.position = this.position;
                    this.body[i][3].style.backgroundColor = this.body[i][2];
                    //追加到body中
                    map._map.appendChild(this.body[i][3]);    
                }
                //求0-20的随机数并向下取整
                this.x = Math.floor(Math.random()*20);
                this.y = Math.floor(Math.random()*20);
                //蛇坐标
                this.body[i][3].style.left = this.body[i][0]*this.width + 'px';
                this.body[i][3].style.top = this.body[i][1]*this.height + 'px';
                //追加到body中
                map._map.appendChild(this.body[i][3]);
               
            }
        }
        //定义setDirect的function(code)
        this.setDirect = function(code)
        {   
            switch(code){
                //左
                case 37:
                    //判断之前的方向反之赋值
                    this.direct = this.direct == 'right'?'right':'left';
                    break;
                //上
                case 38:
                    //判断之前的方向反之赋值
                    this.direct = this.direct == 'down'?'down':'up';
                    break;
                //右
                case 39:
                    //判断之前的方向反之赋值
                    this.direct = this.direct == 'left'?'left':'right';
                    break;
                //下
                case 40:
                    //判断之前的方向反之赋值
                    this.direct = this.direct == 'up'?'up':'down';
                    break;
                default:
                    return;
            }
        }
        //定义move的function
        this.move = function()
        {   
            //长度-1
            var length = this.body.length - 1;
            //倒叙迭代蛇身
            for(var i = length;i > 0;i--)
            {   
                //将元素的横坐标赋值给下一个元素的横坐标
                this.body[i][0] = this.body[i-1][0];
                //将元素的横坐标赋值给下一个元素的横坐标
                this.body[i][1] = this.body[i-1][1];
            }
            
            switch(this.direct)
            {   //左
                case 'left':
                    //蛇头的横坐标减一如果碰到左壁(0)就返回右壁(19)
                    this.body[0][0] = this.body[0][0] == 0 ? 19 : this.body[0][0] - 1;
                    break;
                case 'up':
                    //蛇头的纵坐标减一如果碰到上壁(0)就返回下壁(19)
                    this.body[0][1] = this.body[0][1] == 0 ? 19 : this.body[0][1] - 1;
                    break;
                case 'right':
                    //蛇头的横坐标加一如果碰到右壁(19)就返回左壁(0)
                    this.body[0][0] = this.body[0][0] == 19 ? 0 : this.body[0][0] + 1;
                    break;
                case 'down':
                    //蛇头的横坐标加一如果碰到下壁(19)就返回上壁(0)
                    this.body[0][1] = this.body[0][1] == 19 ? 0 : this.body[0][1] + 1;
                    break;
                default:
                    return;
            }
            
            //吃到食物
            //判断舌头的横纵坐标与食物的横纵坐标相等
            if(this.body[0][0] == food.x && this.body[0][1] == food.y)
            {   
                //最后元素的横坐标
                var x = this.body[length][0];
                //最后元素的纵坐标
                var y = this.body[length][1];
                //加入body
                this.body.push([x,y,'blue',null]);
                //等分加一  
                score++;
                //在title中显示
                document.title = "score:" + score;
                //食物重新显示
                food.show();
            }

            //吃到自己
            for(var i = 1;i < this.body.length;i++)
            {
                //判断自己的身体的横纵坐标与食物的横纵坐标相等
                if(this.body[0][0] == this.body[i][0] && this.body[0][1] == this.body[i][1])
                {
                    //game over
                    alert('GAME OVER');
                    //重新加载
                    window.onload();
                    //return返回
                    return;
                }
            }  
            //调用show()
            this.show();
        }
    }


    //在窗口加载时
    window.onload = function()
    {   
        //赋值map
        map = new Map();
        //调用show
        map.show();
        //赋值snake
        snake = new Snake();
        //调用show()
        snake.show();
        //赋值food
        food = new Food();
        //调用show
        food.show();
        //定时器
        timer = setInterval('snake.move()', 200);
        //获取点击时间
        document.onkeydown = function()
        {   
            //按键
            var code;
            if(window.event)
            {   
                //赋值按键
                code = window.event.keyCode;
            }else
            {   //赋值按键
                code = event.keyCode;
            }
            //调用setDirect参数为按键code
            snake.setDirect(code);
        }
    }
</script>
</body>
</html>